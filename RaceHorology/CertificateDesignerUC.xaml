<UserControl x:Class="RaceHorology.CertificateDesignerUC"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:RaceHorology"
             xmlns:racehorologylib="clr-namespace:RaceHorologyLib;assembly=RaceHorologyLib"
             mc:Ignorable="d"
             d:DesignHeight="768" d:DesignWidth="1536">
  <UserControl.Resources>
    <racehorologylib:TimeSpanConverter x:Key="TimeSpanConverter" />
  </UserControl.Resources>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Toolbar -->
    <ToolBarTray Grid.Row="0">
      <ToolBar>
        <Button Content="Hintergrundbild Laden" Click="OnLoadImageBackground_Click"/>
        <Separator/>
      </ToolBar>
    </ToolBarTray>

    <!-- Main area -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="450"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Property panel -->
      <Grid Grid.Column="0">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Felder"
                   FontSize="20"
                   FontWeight="Bold"
                   Margin="12"/>

        <ListView x:Name="FieldList" Height="250"
              Grid.Row="1"
              Margin="5"
              ItemsSource="{Binding _certificateModel.TextItems, RelativeSource={RelativeSource AncestorType=UserControl}}"
              SelectedItem="{Binding SelectedField, RelativeSource={RelativeSource AncestorType=UserControl}}">
          <ListView.View>
            <GridView>
              <GridViewColumn Header="Value" Width="125" DisplayMemberBinding="{Binding Text}" />
              <GridViewColumn Header="Font"  Width="170" DisplayMemberBinding="{Binding Font}" />
              <GridViewColumn Header="Align" Width="50" DisplayMemberBinding="{Binding Alignment}" />
              <GridViewColumn Header="HPos"  Width="40" DisplayMemberBinding="{Binding HPos, StringFormat=F0}" />
              <GridViewColumn Header="VPos"  Width="40" DisplayMemberBinding="{Binding VPos, StringFormat=F0}" />
            </GridView>
          </ListView.View>
        </ListView>

        <Border Grid.Row="2"
            Margin="5"
            Padding="10"
            BorderThickness="2" BorderBrush="Gray">
          <StackPanel>
            <TextBlock Text="Feld Editor"
                    FontWeight="Bold"
                    Margin="0 0 0 8"/>

            <!-- Text -->
            <StackPanel Orientation="Horizontal" Margin="0 4 0 0">
              <TextBlock Text="Text:" Width="100"/>
              <TextBox Text="{Binding SelectedField.Text, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}" Width="200"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0 4 0 0">
              <TextBlock Text="Seriendruckfeld:" Width="100"/>
              <ComboBox Width="200"
                ItemsSource="{Binding Presets, RelativeSource={RelativeSource AncestorType=UserControl}}"
                SelectionChanged="OnPresetSelectionChanged"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="0 4 0 0">
              <TextBlock Text="Schriftart:" Width="100"/>
              <ComboBox Width="200"
                ItemsSource="{Binding SystemFonts, RelativeSource={RelativeSource AncestorType=UserControl}}"
                DisplayMemberPath="Source"
                SelectedValuePath="Source"
                SelectedValue="{Binding SelectedField.FontFamilyName, RelativeSource={RelativeSource AncestorType=UserControl}, Mode=TwoWay}"/>
            </StackPanel>

            <!-- Font size -->
            <StackPanel Orientation="Horizontal" Margin="0 4 0 0">
              <TextBlock Text="Font Size:" Width="100"/>
              <Slider Minimum="8"
                Maximum="96"
                Width="200"
                Value="{Binding SelectedField.FontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                TickFrequency="1"
                IsSnapToTickEnabled="True"
                SmallChange="1"
                LargeChange="2"
                AutoToolTipPlacement="BottomRight"
                AutoToolTipPrecision="0"/>
              <TextBlock Text="{Binding SelectedField.FontSize, StringFormat=F0}"
                   Margin="0 4 0 0"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal">
              <StackPanel>
                <!-- Bold -->
                <StackPanel Orientation="Horizontal" Margin="0 4 0 0">
                  <TextBlock Text="Fett:" Width="100"/>
                  <CheckBox IsChecked="{Binding SelectedField.IsBold, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                </StackPanel>

                <!-- IsItalic -->
                <StackPanel Orientation="Horizontal" Margin="0 4 0 0">
                  <TextBlock Text="Kursiv:" Width="100"/>
                  <CheckBox IsChecked="{Binding SelectedField.IsItalic, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                </StackPanel>


                <!-- Alignment -->
                <StackPanel Orientation="Horizontal" Margin="0 4 0 0">
                  <TextBlock Text="Ausrichtung:" Width="100"/>

                  <ComboBox Width="80"
                            ItemsSource="{Binding AlignmentValues, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            SelectedItem="{Binding SelectedField.Alignment, Mode=TwoWay}"/>
                </StackPanel>

                <!-- X/Y -->
                <StackPanel Orientation="Horizontal" Margin="0 8 0 0">
                  <TextBlock Text="X:" Width="100"/>
                  <TextBox Width="80"
                  Text="{Binding SelectedField.HPos, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"/>

                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0 8 0 0">
                  <TextBlock Text="Y:" Width="100"/>
                  <TextBox Width="80"
                   Text="{Binding SelectedField.VPos, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
              </StackPanel>
              <StackPanel>

                <Grid Margin="20 10 10 10">
                  <!-- 5 rows × 5 columns -->
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>

                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="30"/>
                  </Grid.ColumnDefinitions>


                  <Button Margin="1" Grid.Row="0" Grid.Column="1" Content="↖↖"  Click="MoveUpLeftLarge"/>
                  <Button Margin="1" Grid.Row="0" Grid.Column="3" Content="↑↑"   Click="MoveUpLarge"/>
                  <Button Margin="1" Grid.Row="0" Grid.Column="5" Content="↗↗"  Click="MoveUpRightLarge"/>

                  <Button Margin="1" Grid.Row="1" Grid.Column="2" Content="↖" Click="MoveUpLeftSmall"/>
                  <Button Margin="1" Grid.Row="1" Grid.Column="3" Content="↑" Click="MoveUpSmall"/>
                  <Button Margin="1" Grid.Row="1" Grid.Column="4" Content="↗" Click="MoveUpRightSmall"/>

                  <!-- Row 2 — small left/down/right -->
                  <Button Margin="1" Grid.Row="2" Grid.Column="0" Content="L" Click="AllignLeft"/>
                  <Button Margin="1" Grid.Row="2" Grid.Column="1" Content="←←" Click="MoveLeftLarge"/>
                  <Button Margin="1" Grid.Row="2" Grid.Column="2" Content="←"  Click="MoveLeftSmall"/>
                  <Button Margin="1" Grid.Row="2" Grid.Column="3" Content="C" Click="CenterHorizontally"/>
                  <Button Margin="1" Grid.Row="2" Grid.Column="4" Content="→"  Click="MoveRightSmall"/>
                  <Button Margin="1" Grid.Row="2" Grid.Column="5" Content="→→" Click="MoveRightLarge"/>
                  <Button Margin="1" Grid.Row="2" Grid.Column="6" Content="R" Click="AllignRight"/>

                  <Button Margin="1" Grid.Row="3" Grid.Column="2" Content="↙" Click="MoveDownLeftSmall"/>
                  <Button Margin="1" Grid.Row="3" Grid.Column="3" Content="↓" Click="MoveDownSmall"/>
                  <Button Margin="1" Grid.Row="3" Grid.Column="4" Content="↘" Click="MoveDownRightSmall"/>

                  <Button Margin="1" Grid.Row="4" Grid.Column="1" Content="↙↙" Click="MoveDownLeftLarge"/>
                  <Button Margin="1" Grid.Row="4" Grid.Column="3" Content="↓↓" Click="MoveDownLarge"/>
                  <Button Margin="1" Grid.Row="4" Grid.Column="5" Content="↘↘" Click="MoveDownRightLarge"/>

                </Grid>

              </StackPanel>
            </StackPanel>

            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 20 0 0">
              <Button Width="100" Content="Feld hinzufügen" Click="OnAddField"/>
              <Button Width="100" Margin="10 0 0 0" Content="Feld löschen" Click="OnDeleteField">
                <Button.Style>
                  <Style TargetType="Button">
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding SelectedField, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="{x:Null}">
                        <Setter Property="IsEnabled" Value="False"/>
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Button.Style>
              </Button>
            </StackPanel>

          </StackPanel>
        </Border>

        <Grid Grid.Row="4" Margin="5 0 5 0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <local:SaveOrResetUC x:Name="ucSaveOrReset"  HorizontalAlignment="Left" />
          <Button x:Name="btnImport" Content="Importieren" Click="btnImport_Click" Grid.Column="2"/>          
        </Grid>
        
      </Grid>

      <Grid Grid.Column="1">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <StackPanel Orientation="Horizontal">

          <TextBlock Text="Zoom" FontSize="20" FontWeight="Bold" Margin="12"/>
          <ComboBox Width="80" SelectedValuePath="Tag" SelectionChanged="OnZoomPresetChanged" Height="25" SelectedIndex="0">
            <ComboBoxItem Content="50%" Tag="0.5"/>
            <ComboBoxItem Content="75%" Tag="0.75"/>
            <ComboBoxItem Content="100%" Tag="1"/>
          </ComboBox>


          <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0,0,0">
            <TextBlock Text="Hilfslinien anzeigen" VerticalAlignment="Center" Margin="0,0,6,0"/>
            <CheckBox x:Name="cbHelperLines"
                  VerticalAlignment="Center"
                  Checked="OnHelperLinesToggled"
                  Unchecked="OnHelperLinesToggled"/>
          </StackPanel>
        </StackPanel>
        <!-- Design surface -->
        <ScrollViewer Grid.Row="1" Margin="5"                      
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      Background="#3f434b">
          <!-- Sichtbarer Rahmen um die A4-Fläche -->
          <Border x:Name="DesignFrame" BorderBrush="#7F808080" BorderThickness="2" CornerRadius="4"
           Background="White" HorizontalAlignment="Center" VerticalAlignment="Center"
           SnapsToDevicePixels="True" >
            <Border.RenderTransform>
              <ScaleTransform x:Name="ZoomTransform" ScaleX="0.75" ScaleY="0.75"/>
              <!-- Start: 75% -->
            </Border.RenderTransform>

            <Grid >
              <Image x:Name="BackgroundImage"
                      Stretch="Fill" />

              <Canvas x:Name="HelperLinesCanvas"
                      IsHitTestVisible="False"
                      Background="Transparent" />

              <!-- Overlay für verschiebbare Felder -->
              <Canvas x:Name="OverlayCanvas" Background="Transparent"/>
            </Grid>
          </Border>
        </ScrollViewer>
      </Grid>
    </Grid>
  </Grid>
</UserControl>
